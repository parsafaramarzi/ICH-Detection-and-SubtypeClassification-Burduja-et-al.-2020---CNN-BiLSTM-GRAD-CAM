"""
# Accurate and Efficient Intracranial Hemorrhage (ICH) Detection and Subtype Classification

This repository implements the architecture proposed in the paper **"Accurate and Efficient Intracranial Hemorrhage Detection and Subtype Classification in 3D CT Scans with Convolutional and Long Short-Term Memory Neural Networks"** by Burduja et al. (2020).

The system is designed for patient-level classification of ICH and its five subtypes based on 3D CT scan volumes, utilizing a robust pipeline that includes fixed-length slice sampling and a combined CNN-BiLSTM network.

## üß† Architecture Overview

The core model, `FullModel`, is a sequential deep neural network that processes 3D volumes slice-by-slice:

1.  **CNN (Slice-Level Feature Extractor):** A Convolutional Neural Network (e.g., ResNet) processes individual CT slices (after windowing/normalization) to produce a feature embedding. This output is also used to calculate an auxiliary slice-level loss.
2.  **Bi-LSTM (Scan-Level Classifier):** The sequence of feature embeddings generated by the CNN for a patient's sampled slices is fed into a Bidirectional Long Short-Term Memory (Bi-LSTM) network. This layer captures temporal/spatial context across the scan volume and generates the final patient-level diagnosis.

## üõ†Ô∏è Setup and Installation

### Prerequisites

* Python 3.8+
* PyTorch (Currently configured for CPU-only training)

### Dependencies

Install the necessary Python libraries:

```bash
pip install torch torchvision torchaudio numpy pandas scikit-learn nibabel opencv-python albumentations
```

### Data Structure

The project expects the input data to be organized as follows:

```
/data
‚îú‚îÄ‚îÄ hemorrhage_diagnosis_raw_ct.csv   # Master CSV with slice-level labels
‚îî‚îÄ‚îÄ ct_scans/
    ‚îú‚îÄ‚îÄ 001.nii                      # NIfTI file for Patient 1 (3D Volume)
    ‚îú‚îÄ‚îÄ 002.nii
    ‚îî‚îÄ‚îÄ ...
```

## üöÄ Training

The `src/train.py` script executes the entire training pipeline. The `HemorrhageDataset` wrapper class ensures that a fixed number of slices (defaulting to 16) is sampled from each patient's 3D volume before batching, which is critical for preventing the "Trying to resize storage that is not resizable" error when using `DataLoader`.

### Execution

To begin training:

```bash
python src/train.py
```

### Key Training Parameters (in `src/train.py`)

| Parameter | Default Value | Description |
| :--- | :--- | :--- |
| `BATCH_SIZE` | `4` | Number of patients per batch (affects fixed sequence length stacking). |
| `IMG_SIZE` | `256` | Target pixel size for slices. |
| `EPOCHS` | `10` | Total training epochs. |
| `AUXILIARY_LOSS_WEIGHT` | `0.5` | Weight for the auxiliary slice-level loss. |
"""
